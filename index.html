<!DOCTYPE html>
<html>
<head>
    <title>Telegram Unity WebGL App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
        }
        #unity-container {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #unity-canvas {
            width: 960px;
            height: 600px;
            background: #FFFFFF;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div id="loading">Loading...</div>
    <div id="unity-container">
        <canvas id="unity-canvas"></canvas>
    </div>

    <script>
        // Инициализация Telegram Web App
        const tg = window.Telegram.WebApp;
        
        // Расширяем на весь экран
        tg.expand();
        
        // Функция для получения информации о Telegram
        function getTelegramData() {
            return {
                initData: tg.initData,
                initDataUnsafe: tg.initDataUnsafe,
                version: tg.version,
                platform: tg.platform,
                colorScheme: tg.colorScheme,
                themeParams: tg.themeParams,
                viewportHeight: tg.viewportHeight,
                viewportStableHeight: tg.viewportStableHeight,
                isExpanded: tg.isExpanded,
                headerColor: tg.headerColor,
                backgroundColor: tg.backgroundColor,
                isClosingConfirmationEnabled: tg.isClosingConfirmationEnabled,
                BackButton: {
                    isVisible: tg.BackButton.isVisible,
                },
                MainButton: {
                    text: tg.MainButton.text,
                    color: tg.MainButton.color,
                    textColor: tg.MainButton.textColor,
                    isVisible: tg.MainButton.isVisible,
                    isProgressVisible: tg.MainButton.isProgressVisible,
                    isActive: tg.MainButton.isActive,
                }
            };
        }

        // Конфигурация Unity
        var buildUrl = "Build/";
        var loaderUrl = buildUrl + "WebGL.loader.js";
        var config = {
            dataUrl: buildUrl + "WebGL.data",
            frameworkUrl: buildUrl + "WebGL.framework.js",
            codeUrl: buildUrl + "WebGL.wasm",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "TelegramUnityApp",
            productName: "Telegram WebGL App",
            productVersion: "1.0",
        };

        // Загрузка Unity
        var script = document.createElement("script");
        script.src = loaderUrl;
        script.onload = () => {
            createUnityInstance(document.querySelector("#unity-canvas"), config)
                .then((unityInstance) => {
                    document.getElementById("loading").style.display = "none";
                    
                    // Передаем данные в Unity после загрузки
                    setTimeout(() => {
                        const telegramData = getTelegramData();
                        unityInstance.SendMessage('TelegramManager', 'SetTelegramData', JSON.stringify(telegramData));
                    }, 1000);
                })
                .catch((message) => {
                    alert("Failed to load Unity: " + message);
                });
        };
        document.body.appendChild(script);
    </script>
</body>
</html>