<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title></title>
    <!-- ���������� ������ ��� ��� ��������� -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* ������� ������ ��������� */
            background: #231F20; /* ���� ���� ���� �������� (������/�����) */
            display: flex; /* �������� flexbox ��� body */
            justify-content: center; /* ���������� ���������� �� ����������� */
            align-items: center; /* ���������� ���������� �� ��������� */
        }
        #unity-container {
            /* ������� ���������� ����������������, ������ ��������� - flex-������� */
            position: relative;
            /* ��� ������ ���������� (����� �������� ������ ��� ������) */
            background: #000000;
            /* ������������ ������������ ������ ������������ 9:16 ������������ ������ ���� */
            max-width: calc(100vh * (9 / 16));
            /* � ������ - 100% �� ���� */
            height: 100vh;
            width: 100%; /* �������� ��� ��������� ������ � �������� max-width */
        }
        #unity-canvas {
            background: #000000;
            /* Canvas ������������� �� 100% �� �������� ������������� ���������� */
            width: 100%;
            height: 100%;
            display: block;
        }
        /* ��� ����� ������� (�����) ����, ��� 100vh * 9/16 ������ 100vw */
        @media (max-aspect-ratio: 9/16) {
            #unity-container {
                max-width: 100vw; /* ������ ���������� - �� �� ���� */
                height: calc(100vw * (16 / 9)); /* ������ ����������� ��������������� */
            }
        }
    </style>
</head>
<body>
	<script>
		// ���������, ��� �� ������ Telegram WebApp
		if (window.Telegram && Telegram.WebApp) {
			const tg = Telegram.WebApp;
			
			// 1. ��������� ���� �� ���� ��������� �����
			tg.expand();
			
			// 2. (�����������) ����������� ���������� ������ ���� � vh (������������ �������)
			// ��������, 90% �� ������ ������ ����������
			tg.setViewportHeight(0.9);
			
			// 3. ��������� �������� ���������� ��� ����� (��������� ��� ���)
			tg.disableVerticalSwipes = true;
			
			console.log('Telegram WebApp initialized. Window expanded.');
		}
	</script>
    <!-- ��������� ��� ���� -->
    <div id="unity-container" class="unity-desktop">
        <canvas id="unity-canvas" width=1080 height=1920 tabindex="-1"></canvas>
        <!-- ����� �������� -->
        <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
                <div id="unity-progress-bar-full"></div>
            </div>
        </div>
        <!-- ������ ��� ������ -->
        <div id="unity-warning"></div>
    </div>

    <!-- �����: ���������� ������ ���������� ��� �����-���� ������ ����� script -->
    <script src="Build/WebGL_Build.loader.js"></script>

    <script>
        // ������������ Unity. Unity ��������� ����������� ����� ������ ����� �������
        var buildUrl = "Build";
        var config = {
            dataUrl: buildUrl + "/WebGL_Build.data",
            frameworkUrl: buildUrl + "/WebGL_Build.framework.js",
            codeUrl: buildUrl + "/WebGL_Build.wasm",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "PheoniX Tech",
            productName: "Altiragame",
            productVersion: "0.0.0.0",
            showBanner: unityShowBanner,
            // ��������� ����-�������� �������, ��������� �������
            matchWebGLToCanvasSize: false
        };

        // ������� ��� ������ ��������� �� �������/���������������
        function unityShowBanner(msg, type) {
            function updateBannerVisibility() {
                warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
            }
            var div = document.createElement('div');
            div.innerHTML = msg;
            warningBanner.appendChild(div);
            if (type == 'error') {
                div.style = 'background: red; padding: 10px;';
            } else {
                if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
                setTimeout(function() {
                    warningBanner.removeChild(div);
                    updateBannerVisibility();
                }, 5000);
            }
            updateBannerVisibility();
        }

        // ������� ��� ��������� ������� canvas ��� ����������� 9:16
        function updateCanvasSize() {
            var canvas = document.querySelector("#unity-canvas");
            var container = document.querySelector("#unity-container");
            var containerWidth = container.clientWidth;
            var containerHeight = container.clientHeight;
            
            // ������� ����������� ������ (������������ iPhone)
            var targetRatio = 9 / 16;
            var currentRatio = containerWidth / containerHeight;
            
            var newWidth, newHeight;
            
            if (currentRatio > targetRatio) {
                // ��������� ������� ������� - ������������ �� ������
                newHeight = containerHeight;
                newWidth = containerHeight * targetRatio;
            } else {
                // ��������� ������� ����� - ������������ �� ������
                newWidth = containerWidth;
                newHeight = containerWidth / targetRatio;
            }
            
            // ��������� ����� �������
            canvas.style.width = newWidth + "px";
            canvas.style.height = newHeight + "px";
            
            // ��������� ���������� ������� canvas ��� ������
            canvas.width = Math.floor(newWidth * window.devicePixelRatio);
            canvas.height = Math.floor(newHeight * window.devicePixelRatio);
        }

        // ������������� ����� �������� ��������
        document.addEventListener('DOMContentLoaded', function() {
            var canvas = document.querySelector("#unity-canvas");
            var container = document.querySelector("#unity-container");
            var warningBanner = document.querySelector("#unity-warning");
            
            // ���������, ��������� �� ��� ����������
            if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                // ��������� �����: ����������� �� ���� �����
                container.className = "unity-mobile";
                canvas.className = "unity-mobile";
                
                // ������� ����-��� viewport ��� ��������� ���������
                var meta = document.createElement('meta');
                meta.name = 'viewport';
                meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
                document.getElementsByTagName('head')[0].appendChild(meta);
            } else {
                // ���������� �����: ������ ������������� �������
                canvas.style.width = "1080px";
                canvas.style.height = "1920px";
            }

            // ���������� ����� ��������
            document.querySelector("#unity-loading-bar").style.display = "block";

            // ��������� � ��������� Unity
            if (typeof createUnityInstance !== "undefined") {
                createUnityInstance(canvas, config, function(progress) {
                    // ��������� ��������-���
                    var progressBarFull = document.querySelector("#unity-progress-bar-full");
                    if (progressBarFull) {
                        progressBarFull.style.width = 100 * progress + "%";
                    }
                }).then(function(unityInstance) {
                    // �������� ����� �������� ����� �������� ��������
                    document.querySelector("#unity-loading-bar").style.display = "none";
                    
                    // ����������� ������ �������������� ������
                    var fullscreenButton = document.querySelector("#unity-fullscreen-button");
                    if (fullscreenButton) {
                        fullscreenButton.onclick = function() {
                            unityInstance.SetFullscreen(1);
                        };
                    }
                    
                    // ������������� ��������� ������ canvas
                    updateCanvasSize();
                    
                    // ��������� ������ ��� ��������� ����
                    window.addEventListener('resize', updateCanvasSize);
                    window.addEventListener('orientationchange', function() {
                        setTimeout(updateCanvasSize, 100);
                    });
                    
                }).catch(function(message) {
                    // ��������� ������ ��������
                    alert("Failed to load game: " + message);
                    document.querySelector("#unity-loading-bar").style.display = "none";
                });
            } else {
                // ���� ��������� Unity �� �����������
                unityShowBanner("Failed to load Unity WebGL player. Please check your browser settings.", "error");
                document.querySelector("#unity-loading-bar").style.display = "none";
            }
        });
    </script>
</body>
</html>
